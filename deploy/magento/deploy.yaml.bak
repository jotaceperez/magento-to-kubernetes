apiVersion: apps/v1
kind: Deployment
metadata:
  name: magento-app
  namespace: magento
  labels:
    app: magento-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: magento-app
  template:
    metadata:
      labels:
        app: magento-app
    spec:
            # initContainers:
            # - name: install
            #   image: busybox
            #   volumeMounts: 
            #   - name: magento-app-stroage
            #     mountPath: /magento
            #   command:
            #   - wget
            #   - "-O"
            #   - "/magento/index.php"
            #   - https://raw.githubusercontent.com/do-community/php-kubernetes/master/index.php
      containers:
              # - name: php
              #   image: php:7-fpm
              #   volumeMounts:
              #   - name: magento-app-stroage
              #     mountPath: /magento
      - name: magento
        image: 295038636998.dkr.ecr.us-west-2.amazonaws.com/ecp-cafe/tony:magento2.3.4-1
        volumeMounts:
        - name: magento-app-stroage
          mountPath: /magento
      volumes:
      - name: magento-app-stroage
        persistentVolumeClaim:
          claimName: magento-app-pvc

